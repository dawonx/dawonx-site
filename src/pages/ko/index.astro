---
import { getCollection } from 'astro:content';
import BaseLayout from '../../layouts/BaseLayout.astro';
import Card from '../../components/Card.astro';

// Filter Korean versions
const blogPosts = (await getCollection('blog'))
  .filter(post => post.id.endsWith('.ko.md'))
  .sort((a, b) => new Date(b.data.date) - new Date(a.data.date));

const workPosts = (await getCollection('work'))
  .filter(post => post.id.endsWith('.ko.md'))
  .sort((a, b) => new Date(b.data.date || '2025-01-01') - new Date(a.data.date || '2025-01-01'));

const researchPosts = (await getCollection('research'))
  .filter(post => post.id.endsWith('.ko.md'))
  .sort((a, b) => new Date(b.data.date || '2025-01-01') - new Date(a.data.date || '2025-01-01'));

// Calculate series totals
const seriesCount = {};
blogPosts.forEach(post => {
  if (post.data.series) {
    seriesCount[post.data.series.name] = (seriesCount[post.data.series.name] || 0) + 1;
  }
});
---

<BaseLayout title="DAWONX | 지속가능성을 위한 컴퓨테이셔널 디자인" showGradient={true}>
    <div style="flex: 1; display: flex; flex-direction: column;">
    <!-- Hero Section -->
    <main id="hero">
        <div class="hero-content">
            <div class="hero-text-wrapper">
                <h1 class="hero-title">
                    <span class="title-line">지속가능한 미래를</span>
                    <span class="title-line">디자인합니다</span>
                </h1>
                <span class="hero-label">Computational Designer</span>
            </div>
        </div>
    </main>

    <!-- Work Section -->
    <section class="showcase-section work-section" id="work-section">
        <div class="section-header">
            <div class="section-info">
                <h2 class="section-title">Work</h2>
            </div>
            <div class="category-tabs">
                <button class="tab-btn active" data-category="all">All</button>
                <button class="tab-btn" data-category="architecture">Architecture</button>
                <button class="tab-btn" data-category="branding">Branding & Identity</button>
                <button class="tab-btn" data-category="engineering">Engineering</button>
                <button class="tab-btn" data-category="publications">Publications</button>
                <button class="tab-btn" data-category="development">Development</button>
            </div>
        </div>
        <div class="carousel-container">
            <button class="carousel-btn prev" aria-label="Previous">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>
            <div class="carousel-track" id="work-carousel">
                {workPosts.slice(0, 6).map(post => (
                    <Card
                        title={post.data.title_ko || post.data.title}
                        category={post.data.category}
                        subcategory={post.data.subcategory}
                        image={post.data.image}
                        path={`/ko/work/${post.slug.replace('.ko', '')}`}
                    />
                ))}
            </div>
            <button class="carousel-btn next" aria-label="Next">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </button>
        </div>
    </section>

    <!-- Research Section -->
    <section class="showcase-section research-section" id="research-section">
        <div class="section-header">
            <div class="section-info">
                <h2 class="section-title">Research</h2>
            </div>
            <div class="category-tabs">
                <button class="tab-btn active" data-category="all">All</button>
                <button class="tab-btn" data-category="cross-industry">Cross-Industry</button>
                <button class="tab-btn" data-category="sustainability">Sustainability</button>
                <button class="tab-btn" data-category="modular">Modular Systems</button>
                <button class="tab-btn" data-category="fabrication">Digital Fabrication</button>
            </div>
        </div>
        <div class="carousel-container">
            <button class="carousel-btn prev" aria-label="Previous">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>
            <div class="carousel-track" id="research-carousel">
                {researchPosts.slice(0, 6).map(post => (
                    <Card
                        title={post.data.title_ko || post.data.title}
                        category={post.data.category}
                        subcategory={post.data.subcategory}
                        image={post.data.image}
                        path={`/ko/research/${post.slug.replace('.ko', '')}`}
                    />
                ))}
            </div>
            <button class="carousel-btn next" aria-label="Next">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </button>
        </div>
    </section>

    <!-- Blog Section -->
    <section class="showcase-section blog-section" id="blog-section">
        <div class="section-header">
            <div class="section-info">
                <h2 class="section-title">Blog</h2>
            </div>
            <div class="category-tabs">
                <button class="tab-btn active" data-category="all">All</button>
                <button class="tab-btn" data-category="computational">Computational Design</button>
                <button class="tab-btn" data-category="ai">AI & Machine Learning</button>
                <button class="tab-btn" data-category="experiments">Experiments</button>
            </div>
        </div>
        <div class="carousel-container">
            <button class="carousel-btn prev" aria-label="Previous">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M15 18l-6-6 6-6"/>
                </svg>
            </button>
            <div class="carousel-track" id="blog-carousel">
                {blogPosts.slice(0, 6).map(post => (
                    <Card
                        title={post.data.title_ko || post.data.title}
                        category={post.data.category}
                        subcategory={post.data.subcategory}
                        image={post.data.image}
                        path={`/ko/blog/${post.slug.replace('.ko', '')}`}
                        date={post.data.date}
                        series={post.data.series ? {
                            name: post.data.series.name,
                            order: post.data.series.order,
                            total: seriesCount[post.data.series.name]
                        } : undefined}
                    />
                ))}
            </div>
            <button class="carousel-btn next" aria-label="Next">
                <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                    <path d="M9 18l6-6-6-6"/>
                </svg>
            </button>
        </div>
    </section>

    <script>
        // Carousel functionality
        document.querySelectorAll('.carousel-container').forEach(container => {
            const track = container.querySelector('.carousel-track');
            const prevBtn = container.querySelector('.prev');
            const nextBtn = container.querySelector('.next');

            if (!track) return;

            prevBtn?.addEventListener('click', () => {
                track.scrollBy({ left: -300, behavior: 'smooth' });
            });

            nextBtn?.addEventListener('click', () => {
                track.scrollBy({ left: 300, behavior: 'smooth' });
            });
        });

        // Category filtering for homepage
        document.querySelectorAll('.showcase-section').forEach(section => {
            const tabs = section.querySelectorAll('.tab-btn');
            const cards = section.querySelectorAll('.showcase-card');

            tabs.forEach(tab => {
                tab.addEventListener('click', () => {
                    const category = tab.dataset.category;

                    // Update active tab
                    tabs.forEach(t => t.classList.remove('active'));
                    tab.classList.add('active');

                    // Filter cards
                    cards.forEach(card => {
                        const cardCategory = card.querySelector('.card-category')?.textContent.toLowerCase();
                        if (category === 'all' || cardCategory?.includes(category)) {
                            card.style.display = 'block';
                        } else {
                            card.style.display = 'none';
                        }
                    });
                });
            });
        });
    </script>
    </div>
</BaseLayout>
